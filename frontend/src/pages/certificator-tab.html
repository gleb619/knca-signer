<!-- Certificate Manager Tab -->
<div class="max-w-7xl mx-auto" x-data="certificatorTab"
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-end="opacity-100 transform translate-x-0"
     x-transition:enter-start="opacity-0 transform translate-x-4"
     x-transition:leave="transition ease-in duration-200"
     x-transition:leave-end="opacity-0 transform -translate-x-4"
     x-transition:leave-start="opacity-100 transform translate-x-0">
    <div class="flex flex-col lg:flex-row gap-6" x-cloak x-show="activeTab === 'certificate-authority'">

        <!-- Sidebar -->
        <div class="w-full lg:w-1/4">
            <div class="bg-white rounded-lg shadow-sm p-4">
                <h4 class="text-base font-semibold mb-3 text-gray-700"
                    x-text="translate('certificateAuthorities')"></h4>

                <!-- Create CA Button -->
                <button :class="activeSubTab === 'create' ? 'bg-blue-300 text-blue-800' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'"
                        @click="activeSubTab = 'create'"
                        class="w-full py-3 px-4 mb-3 rounded-lg font-medium transition-colors duration-200 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M12 6v6m0 0v6m0-6h6m-6 0H6" stroke-linecap="round" stroke-linejoin="round"
                              stroke-width="2"/>
                    </svg>
                    <span x-text="translate('createCa')"></span>
                </button>

                <div class="space-y-1" x-cloak x-show="certificates.length > 0">
                    <template :key="caStructure.alias" x-for="caStructure in certificates">
                        <button :class="activeSubTab === caStructure.alias ? 'bg-blue-300 text-blue-800' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'"
                                @click="activeSubTab = caStructure.alias"
                                class="w-full py-3 px-4 mb-2 rounded-lg font-medium transition-colors duration-200 flex items-center justify-between">
                            <span x-text="`CA: ${caStructure.alias}`"></span>
                            <span class="text-xs bg-white bg-opacity-50 rounded-full px-2 py-1"
                                  x-text="`${caStructure.userCertificates.length + caStructure.legalCertificates.length} certs`"></span>
                        </button>
                    </template>
                </div>

                <!-- Empty state for sidebar -->
                <div class="text-center py-4 text-gray-500" x-cloak x-show="certificates.length === 0">
                    <svg class="w-8 h-8 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor"
                         viewBox="0 0 24 24">
                        <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                              stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
                    </svg>
                    <p class="text-xs" x-text="translate('noCAsYet')"></p>
                </div>

                <!-- Help Section -->
                <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                    <h5 class="text-sm font-medium text-blue-700 mb-2" x-text="translate('howItWorks')"></h5>
                    <p class="text-xs text-blue-600" x-cloak x-show="activeSubTab === 'create'"
                       x-text="translate('createCaHelpCreate')"></p>
                    <p class="text-xs text-blue-600" x-cloak x-show="activeSubTab !== 'create'"
                       x-text="translate('viewManageCertsHelp')"></p>
                </div>
            </div>
        </div>


        <!-- Main Content Area -->
        <div class="w-full lg:w-3/4">
            <!-- Global Loading Overlay -->
            <div class="fixed inset-0 bg-black bg-opacity-25 flex items-center justify-center z-50" x-cloak
                 x-show="generatingCA || generatingUser || generatingLegal">
                <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
                    <div class="flex items-center space-x-3">
                        <svg class="animate-spin h-6 w-6 text-blue-600" fill="none" stroke="currentColor"
                             viewBox="0 0 24 24">
                            <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0-4H9m11 11v-5h-.581m0 0H15m5.356-4A8.001 8.001 0 0014.418 15" stroke-linecap="round" stroke-linejoin="round"
                                  stroke-width="2"/>
                        </svg>
                        <div>
                            <p class="font-medium text-gray-900"
                               x-text="generatingCA ? translate('creatingCertificateAuthority') : generatingUser ? translate('generatingUserCertificate') : translate('generatingLegalCertificate')"></p>
                            <p class="text-sm text-gray-500" x-text="translate('loading')"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Create CA Tab -->
            <template x-if="activeSubTab === 'create'">
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4"
                        x-text="translate('createCertificateAuthority')"></h2>
                    <p class="text-gray-600 mb-6" x-text="translate('createCaDesc')">
                    </p>

                    <!-- CA Generation Form -->
                    <div class="max-w-md">
                        <label class="block text-sm font-medium text-gray-700 mb-2" for="caAlias"
                               x-text="translate('caAliasLabel')">
                        </label>
                        <input class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4"
                               id="caAlias"
                               :placeholder="translate('caAliasPlaceholder')"
                               type="text"
                               x-model="newCAAlias">
                        <button :disabled="generatingCA"
                                @click="generateCA"
                                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" x-cloak
                                 x-show="!generatingCA">
                                <path d="M12 6v6m0 0v6m0-6h6m-6 0H6" stroke-linecap="round" stroke-linejoin="round"
                                      stroke-width="2"/>
                            </svg>
                            <svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                 x-cloak
                                 x-show="generatingCA">
                                <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0-4H9m11 11v-5h-.581m0 0H15m5.356-4A8.001 8.001 0 0014.418 15"
                                      stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
                            </svg>
                            <span x-text="generatingCA ? translate('creatingCA') : translate('createCA')"></span>
                        </button>
                    </div>
                </div>
            </template>

            <!-- CA Certificate Details View - Refactored using regular x-for loop -->
            <template x-if="activeSubTab !== 'create'">
                <div x-cloak x-show="certificates.length > 0">
                    <template :key="caStructure.alias" x-for="(caStructure, caIdx) in certificates">
                        <div x-cloak x-show="activeSubTab === caStructure.alias"
                             x-transition:enter="transition ease-out duration-300"
                             x-transition:enter-end="opacity-100 transform translate-x-0"
                             class="mb-4 pb-2"
                             x-transition:enter-start="opacity-0 transform translate-x-4">

                            <!-- CA Header -->
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-4">
                                        <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold text-lg">
                                            CA
                                        </div>
                                        <div>
                                            <h2 class="text-2xl font-bold text-gray-900">
                                                <span x-text="caStructure.alias"></span>
                                                <button :title="translate('copyJson')"
                                                        @click="copyToClipboardHandler(JSON.stringify(caStructure, null, 2))"
                                                        class="text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100">
                                                    <svg class="w-5 h-5" fill="none" stroke="currentColor"
                                                         viewBox="0 0 24 24">
                                                        <path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                                                              stroke-linecap="round" stroke-linejoin="round"
                                                              stroke-width="2"></path>
                                                    </svg>
                                                </button>
                                            </h2>
                                            <p class="text-gray-600"
                                               x-text="caStructure.ca.subject || translate('certificateAuthority')"></p>
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button :disabled="generatingUser"
                                                @click="generateUser(caStructure.alias)"
                                                class="px-2.5 py-1.5 bg-green-600 text-sm text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                                 x-cloak
                                                 x-show="!generatingUser">
                                                <path d="M12 6v6m0 0v6m0-6h6m-6 0H6" stroke-linecap="round"
                                                      stroke-linejoin="round" stroke-width="2"/>
                                            </svg>
                                            <span x-text="generatingUser ? translate('generating') : translate('newUserCert')"></span>
                                        </button>
                                        <button :disabled="generatingLegal"
                                                @click="generateLegal(caStructure.alias)"
                                                class="px-2.5 py-1.5 bg-orange-600 text-sm text-white rounded-lg hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                                 x-cloak
                                                 x-show="!generatingLegal">
                                                <path d="M12 6v6m0 0v6m0-6h6m-6 0H6" stroke-linecap="round"
                                                      stroke-linejoin="round" stroke-width="2"/>
                                            </svg>
                                            <span x-text="generatingLegal ? translate('generating') : translate('newLegalCert')"></span>
                                        </button>
                                    </div>
                                </div>

                                <!-- CA Details -->
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <span class="text-gray-500" x-text="translate('validFromLabel')"></span>
                                        <span class="ml-2 text-gray-900"
                                              x-text="formatDate(caStructure.ca.notBefore)"></span>
                                    </div>
                                    <div>
                                        <span class="text-gray-500" x-text="translate('validUntilLabel')"></span>
                                        <span class="ml-2 text-gray-900"
                                              x-text="formatDate(caStructure.ca.notAfter)"></span>
                                    </div>
                                    <div>
                                        <span class="text-gray-500" x-text="translate('aliasLabel')"></span>
                                        <span class="ml-2 text-gray-900" x-text="caStructure.ca.alias"></span>
                                    </div>
                                    <div class="overflow-hidden text-ellipsis inline-flex" x-cloak
                                         x-show="caStructure.ca.serialNumber">
                                        <span class="text-gray-500 mr-2 truncate" title="serial"
                                              x-text="translate('serialLabel')"></span>

                                        <div class="flex items-center gap-2">
                                            <code :title="caStructure.ca.serialNumber"
                                                  class="text-xs text-gray-700 font-mono bg-gray-50 px-1 py-1 rounded flex-1 overflow-hidden text-ellipsis"
                                                  x-text="caStructure.ca.serialNumber"></code>
                                            <button @click="copyToClipboardHandler(caStructure.ca.serialNumber)"
                                                    class="text-gray-400 hover:text-gray-600">
                                                <svg class="w-3 h-3" fill="none" stroke="currentColor"
                                                     viewBox="0 0 24 24">
                                                    <path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                                                          stroke-linecap="round" stroke-linejoin="round"
                                                          stroke-width="2"></path>
                                                </svg>
                                            </button>
                                        </div>

                                    </div>
                                    <div x-cloak x-show="caStructure.ca.publicKeyAlgorithm || caStructure.ca.keySize">
                                        <span class="text-gray-500" x-text="translate('keyLabel')"></span>
                                        <span class="ml-2 text-gray-900" x-text="formatKeyInfo(caStructure.ca)"></span>
                                    </div>
                                </div>

                                <!-- Download Section -->
                                <div class="mt-4 space-y-2" x-cloak x-show="caStructure.ca.serialNumber">
                                    <span class="text-gray-500 text-xs uppercase font-medium"
                                          x-text="translate('downloadFormats')"></span>
                                    <div class="flex flex-wrap gap-2">
                                        <button @click="downloadCertificate(caStructure.ca.alias, 'crt')"
                                                class="inline-flex items-center px-2 py-1 text-xs font-medium text-blue-700 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded transition-colors duration-200">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor"
                                                 viewBox="0 0 24 24">
                                                <path d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                                                      stroke-linecap="round" stroke-linejoin="round"
                                                      stroke-width="2"></path>
                                            </svg>
                                            CRT/PEM
                                        </button>
                                        <button @click="downloadCertificate(caStructure.ca.alias, 'p12')"
                                                class="inline-flex items-center px-2 py-1 text-xs font-medium text-green-700 bg-green-50 hover:bg-green-100 border border-green-200 rounded transition-colors duration-200">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor"
                                                 viewBox="0 0 24 24">
                                                <path d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                                                      stroke-linecap="round" stroke-linejoin="round"
                                                      stroke-width="2"></path>
                                            </svg>
                                            PKCS12
                                        </button>
                                        <button @click="downloadCertificate(caStructure.ca.alias, 'jks')"
                                                class="inline-flex items-center px-2 py-1 text-xs font-medium text-orange-700 bg-orange-50 hover:bg-orange-100 border border-orange-200 rounded transition-colors duration-200">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor"
                                                 viewBox="0 0 24 24">
                                                <path d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                                                      stroke-linecap="round" stroke-linejoin="round"
                                                      stroke-width="2"></path>
                                            </svg>
                                            JKS
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- User Certificates Cards -->
                            <div hx-get="src/pages/certificator/user-cert-cards.html"
                                 hx-target="this"
                                 hx-trigger="load lateLoad">
                                <div class="text-center py-5">
                                    <div class="animate-pulse">
                                        <div class="h-4 bg-gray-300 rounded w-1/4 mx-auto mb-4"></div>
                                        <div class="h-4 bg-gray-300 rounded w-1/2 mx-auto"></div>
                                    </div>
                                    <p class="text-gray-600 mt-4">Loading user cert cards...</p>
                                </div>
                            </div>

                            <!-- Legal Certificates Cards -->
                            <div hx-get="src/pages/certificator/legal-cert-cards.html"
                                 hx-target="this"
                                 hx-trigger="load lateLoad">
                                <div class="text-center py-5">
                                    <div class="animate-pulse">
                                        <div class="h-4 bg-gray-300 rounded w-1/4 mx-auto mb-4"></div>
                                        <div class="h-4 bg-gray-300 rounded w-1/2 mx-auto"></div>
                                    </div>
                                    <p class="text-gray-600 mt-4">Loading legal cert cards...</p>
                                </div>
                            </div>

                        </div>
                    </template>
                </div>
            </template>
        </div>

    </div>
</div>
</div>
