<!-- XML Signer Tab -->
<div class="max-w-7xl mx-auto" x-data="xmlSignerTab" x-init="initXmlSigner"
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-end="opacity-100 transform translate-x-0"
     x-transition:enter-start="opacity-0 transform translate-x-4"
     x-transition:leave="transition ease-in duration-200"
     x-transition:leave-end="opacity-0 transform -translate-x-4"
     x-transition:leave-start="opacity-100 transform translate-x-0">
    <div @certificate-selected.window="handleCertificateSelection($event.detail)" class="flex flex-col lg:flex-row gap-6" x-cloak
         x-show="activeTab === 'xml-signer'">
        <!-- Sidebar -->
        <div class="w-full lg:w-1/4">
            <div class="bg-white rounded-lg shadow-sm p-4">
                <h4 class="text-base font-semibold mb-3 text-gray-700">Signing Method</h4>
                <button :class="activeSubTab === 'xml' ? 'bg-blue-300 text-blue-800' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'"
                        @click="activeSubTab = 'xml'"
                        class="w-full py-3 px-4 mb-2 rounded-lg font-medium transition-colors duration-200"
                        x-text="translate('xmlSignMethod')">
                </button>
                <button :class="activeSubTab === 'cms' ? 'bg-blue-300 text-blue-800' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'"
                        @click="activeSubTab = 'cms'"
                        class="w-full py-3 px-4 rounded-lg font-medium transition-colors duration-200"
                        x-text="translate('cmsSignMethod')">
                </button>

                <!-- Help Section -->
                <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                    <h5 class="text-sm font-medium text-blue-700 mb-2">How it works</h5>
                    <p class="text-xs text-blue-600" id="signXmlHelp" x-show="activeSubTab === 'xml'">
                        XML signing in NCALayer allows you to add a digital signature to XML documents - think of XML as
                        structured data files commonly used for invoices, contracts, or official forms. This process
                        embeds the signature directly into the document, creating a tamper-proof version that proves the
                        document's authenticity and integrity. NCALayer supports advanced standards like XAdES-BES,
                        which includes timestamping and legal qualifiers, ensuring your signed documents are legally
                        valid and verifiable by third parties. You can customize signature placement, choose from
                        multiple encryption algorithms (RSA with SHA-256/384/512), and add additional security
                        properties for enhanced trust.
                    </p>
                    <p class="text-xs text-blue-600" id="signCmsHelp" x-show="activeSubTab === 'cms'">
                        CMS (Cryptographic Message Syntax) signing creates digital signatures for any type of data or
                        files using the PKCS#7 standard - this is like attaching an official digital stamp or seal that
                        proves who signed something and when. Unlike XML signing which modifies the original document,
                        CMS signatures can be kept separate (detached) or embedded (encapsulated), making them perfect
                        for signing PDFs, images, text files, or any digital content without altering the original.
                        NCALayer supports optional timestamping from trusted authorities, certificate chain inclusion
                        for verification, and even Certificate Revocation List (CRL) embedding to ensure maximum
                        security and legal compliance. This method is widely used for document workflows, legal
                        archiving, and secure file sharing.
                    </p>
                </div>

                <!-- Websocket Section -->
                <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                    <h5 class="text-sm font-medium text-blue-700 mb-2">WebSocket Connection</h5>
                    <div class="flex items-center space-x-2 mb-3">
                        <div :class="isConnected ? 'bg-green-500' : 'bg-red-500'" class="w-3 h-3 rounded-full"></div>
                        <span class="text-sm text-blue-700"
                              x-text="`NCALayer: ${ isConnected ? 'Connected' : 'Disconnected' }`"></span>
                    </div>

                    <!-- Collapsible Logs -->
                    <details class="mt-3">
                        <summary
                                class="flex items-center justify-between cursor-pointer hover:bg-blue-100 p-2 rounded transition-colors">
                            <span class="text-sm font-medium text-blue-700">WebSocket Logs</span>
                            <svg class="w-4 h-4 text-blue-500 transform transition-transform duration-200" fill="none"
                                 stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round"
                                      stroke-width="2"></path>
                            </svg>
                        </summary>
                        <div class="mt-2 max-h-128 overflow-y-auto bg-white rounded m-2 border">
                            <div class="text-xs text-gray-500 italic" x-show="logs.length === 0">No logs yet</div>
                            <div x-show="logs.length > 0">
                                <template :key="log.direction + log.timestamp + logIdx" x-for="(log, logIdx) in logs">
                                    <div :class="log.direction === 'sent' ? 'bg-blue-300' : 'bg-green-300'"
                                         class="text-xs font-mono">
                                        <div class="flex">
                                            <span class="text-white" x-text="log.timestamp"></span>
                                            <span :class="log.direction === 'sent' ? 'bg-blue-500' : 'bg-green-500'"
                                                  class="ml-auto mr-2 px-1 rounded text-white text-xs"
                                                  x-text="log.direction === 'sent' ? '→' : '←'"></span>
                                        </div>
                                        <pre class="ml-1 text-gray-800 break-all overflow-hidden text-ellipsis"
                                             :title="log.message"
                                             x-text="log.message"></pre>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </details>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <template x-if="activeSubTab === 'xml'">
            <div class="w-full lg:w-3/4">
                <form class="space-y-4">
                    <!-- Header -->
                    <div class="bg-white rounded-lg shadow-sm p-4">
                        <h3 class="text-xl font-bold text-gray-700 mb-2" x-text="translate('signMethod')"></h3>
                        <p class="text-sm text-gray-600" x-text="translate('signMethodHelp')">Configure your signing
                            parameters and generate digital signatures</p>
                    </div>

                    <!-- Storage Options Section -->
                    <details class="bg-white rounded-lg shadow-sm">
                        <summary
                                class="flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center">
                                    <svg class="w-3 h-3 text-blue-500" fill="none" stroke="currentColor"
                                         viewBox="0 0 24 24">
                                        <path d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                                              stroke-linecap="round" stroke-linejoin="round"
                                              stroke-width="2"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="text-base font-semibold text-gray-700"
                                        x-text="translate('allowedStorages')"></h4>
                                    <p class="text-sm text-gray-600" x-text="translate('allowedStoragesDesc')"></p>
                                </div>
                            </div>
                            <svg class="w-4 h-4 text-gray-400 transform transition-transform duration-200" fill="none"
                                 stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round"
                                      stroke-width="2"></path>
                            </svg>
                        </summary>
                        <div class="px-4 pb-4">
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                                <label class="flex items-center space-x-2 p-2 rounded hover:bg-gray-50 cursor-pointer">
                                    <input class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                                           id="AKKaztokenStore" name="storage-check" type="checkbox"
                                           value="AKKaztokenStore" x-model="allowedStorages">
                                    <span class="text-sm text-gray-700">AKKaztokenStore</span>
                                </label>
                                <label class="flex items-center space-x-2 p-2 rounded hover:bg-gray-50 cursor-pointer">
                                    <input class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                                           id="AKKZIDCardStore" name="storage-check" type="checkbox"
                                           value="AKKZIDCardStore" x-model="allowedStorages">
                                    <span class="text-sm text-gray-700">AKKZIDCardStore</span>
                                </label>
                                <label class="flex items-center space-x-2 p-2 rounded hover:bg-gray-50 cursor-pointer">
                                    <input class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                                           id="AKEToken72KStore" name="storage-check" type="checkbox"
                                           value="AKEToken72KStore" x-model="allowedStorages">
                                    <span class="text-sm text-gray-700">AKEToken72KStore</span>
                                </label>
                                <label class="flex items-center space-x-2 p-2 rounded hover:bg-gray-50 cursor-pointer">
                                    <input class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                                           id="AKEToken5110Store" name="storage-check" type="checkbox"
                                           value="AKEToken5110Store" x-model="allowedStorages">
                                    <span class="text-sm text-gray-700">AKEToken5110Store</span>
                                </label>
                                <label class="flex items-center space-x-2 p-2 rounded hover:bg-gray-50 cursor-pointer">
                                    <input class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                                           id="AKJaCartaStore" name="storage-check" type="checkbox"
                                           value="AKJaCartaStore" x-model="allowedStorages">
                                    <span class="text-sm text-gray-700">AKJaCartaStore</span>
                                </label>
                                <label class="flex items-center space-x-2 p-2 rounded hover:bg-gray-50 cursor-pointer">
                                    <input class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                                           id="PKCS12" name="storage-check" type="checkbox" value="PKCS12"
                                           x-model="allowedStorages">
                                    <span class="text-sm text-gray-700">PKCS12</span>
                                </label>
                                <label class="flex items-center space-x-2 p-2 rounded hover:bg-gray-50 cursor-pointer">
                                    <input class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                                           id="JKS" name="storage-check" type="checkbox" value="JKS"
                                           x-model="allowedStorages">
                                    <span class="text-sm text-gray-700">JKS</span>
                                </label>
                                <label class="flex items-center space-x-2 p-2 rounded hover:bg-gray-50 cursor-pointer">
                                    <input class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                                           id="AKAKEYStore" name="storage-check" type="checkbox" value="AKAKEYStore"
                                           x-model="allowedStorages">
                                    <span class="text-sm text-gray-700">AKAKEYStore</span>
                                </label>
                            </div>
                        </div>
                    </details>

                    <!-- Data Input Section -->
                    <details class="bg-white rounded-lg shadow-sm" open>
                        <summary
                                class="flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center">
                                    <svg class="w-3 h-3 text-green-500" fill="none" stroke="currentColor"
                                         viewBox="0 0 24 24">
                                        <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                                              stroke-linecap="round" stroke-linejoin="round"
                                              stroke-width="2"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="text-base font-semibold text-gray-700" x-text="translate('data')"></h4>
                                    <p class="text-sm text-gray-600" x-text="translate('dataToSign')">Enter the data you
                                        want to sign</p>
                                </div>
                            </div>
                            <svg class="w-4 h-4 text-gray-400 transform transition-transform duration-200" fill="none"
                                 stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round"
                                      stroke-width="2"></path>
                            </svg>
                        </summary>
                        <div class="px-4 pb-4 space-y-4">
                            <div>
                                <label class="flex items-center space-x-2">
                                    <input class="w-4 h-4 text-green-600 rounded focus:ring-green-500" id="isArray"
                                           name="is-array" type="checkbox" value="isArray" x-model="isArray">
                                    <span class="text-sm text-gray-700" x-text="translate('isArrayLabel')"></span>
                                </label>
                                <p class="text-xs text-gray-500 mt-1" x-text="translate('dataArrayDesc')"></p>
                            </div>
                            <div>
                            <textarea
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 resize-vertical"
                                    id="dataToSign" required
                                    rows="6"
                                    x-bind:placeholder="translate('dataPlaceholder')"
                                    x-model="dataToSign"></textarea>
                            </div>
                            <div class="flex space-x-2">
                                <button @click="dataToSign = '<example><data>Hello World</data></example>'; isArray = false; decode = false"
                                        class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors"
                                        type="button"
                                        x-text="translate('loadXMLExample')">
                                    Load XML Example
                                </button>
                                <button @click="dataToSign = 'SGVsbG8gV29ybGQ='; isArray = false; decode = true"
                                        class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors"
                                        type="button"
                                        x-text="translate('loadBase64Example')">
                                    Load Base64 Example
                                </button>
                            </div>
                        </div>
                    </details>

                    <!-- Signing Parameters Section -->
                    <details class="bg-white rounded-lg shadow-sm">
                        <summary
                                class="flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center">
                                    <svg class="w-3 h-3 text-purple-500" fill="none" stroke="currentColor"
                                         viewBox="0 0 24 24">
                                        <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                                              stroke-linecap="round" stroke-linejoin="round"
                                              stroke-width="2"></path>
                                        <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" stroke-linecap="round"
                                              stroke-linejoin="round"
                                              stroke-width="2"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="text-base font-semibold text-gray-700"
                                        x-text="translate('signingParams')"></h4>
                                    <p class="text-sm text-gray-600" x-text="translate('advancedOptions')">Advanced
                                        signing configuration options</p>
                                </div>
                            </div>
                            <svg class="w-4 h-4 text-gray-400 transform transition-transform duration-200" fill="none"
                                 stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round"
                                      stroke-width="2"></path>
                            </svg>
                        </summary>
                        <div class="px-4 pb-4 space-y-4">
                            <!-- Decode Option -->
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-gray-700">Decode</label>
                                <p class="text-xs text-gray-500" x-text="translate('decodeDesc')"></p>
                                <div class="flex space-x-6">
                                    <label class="flex items-center">
                                        <input class="w-4 h-4 text-purple-600 focus:ring-purple-500" name="decode"
                                               type="radio" value="true" x-model="decode">
                                        <span class="ml-2 text-sm text-gray-700">True</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input class="w-4 h-4 text-purple-600 focus:ring-purple-500" name="decode"
                                               type="radio" value="false" x-model="decode">
                                        <span class="ml-2 text-sm text-gray-700">False</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Encapsulate Option -->
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-gray-700">Encapsulate</label>
                                <p class="text-xs text-gray-500" x-text="translate('encapsulateDesc')"></p>
                                <div class="flex space-x-6">
                                    <label class="flex items-center">
                                        <input class="w-4 h-4 text-purple-600 focus:ring-purple-500" name="encapsulate"
                                               type="radio" value="true" x-model="encapsulate">
                                        <span class="ml-2 text-sm text-gray-700">True</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input class="w-4 h-4 text-purple-600 focus:ring-purple-500" name="encapsulate"
                                               type="radio" value="false" x-model="encapsulate">
                                        <span class="ml-2 text-sm text-gray-700">False</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Digested Option -->
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-gray-700">Digested</label>
                                <p class="text-xs text-gray-500" x-text="translate('digestedDesc')"></p>
                                <div class="flex space-x-6">
                                    <label class="flex items-center">
                                        <input class="w-4 h-4 text-purple-600 focus:ring-purple-500" name="digested"
                                               type="radio" value="true" x-model="digested">
                                        <span class="ml-2 text-sm text-gray-700">True</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input class="w-4 h-4 text-purple-600 focus:ring-purple-500" name="digested"
                                               type="radio" value="false" x-model="digested">
                                        <span class="ml-2 text-sm text-gray-700">False</span>
                                    </label>
                                </div>
                            </div>

                            <!-- TSA Profile -->
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-gray-700">TSA Profile</label>
                                <p class="text-xs text-gray-500" x-text="translate('tsaDesc')"></p>
                                <label class="flex items-center">
                                    <input class="w-4 h-4 text-purple-600 rounded focus:ring-purple-500" id="tsaProfile"
                                           type="checkbox" x-model="tsaProfile">
                                    <span class="ml-2 text-sm text-gray-700">Enable TSA Profile</span>
                                </label>
                            </div>

                            <!-- Test Parameters -->
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-gray-700">Test Parameters</label>
                                <p class="text-xs text-gray-500" x-text="translate('testParamsDesc')"></p>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input class="w-4 h-4 text-purple-600 rounded focus:ring-purple-500"
                                               id="isAllowExpired" type="checkbox" x-model="isAllowExpired">
                                        <span class="ml-2 text-sm text-gray-700"
                                              x-text="translate('allowExpiredCertificates')">Allow Expired Certificates</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input class="w-4 h-4 text-purple-600 rounded focus:ring-purple-500"
                                               id="isAllowRevoked" type="checkbox" x-model="isAllowRevoked">
                                        <span class="ml-2 text-sm text-gray-700"
                                              x-text="translate('allowRevokedCertificates')">Allow Revoked Certificates</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Output Certificate -->
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-gray-700">Output Certificate</label>
                                <p class="text-xs text-gray-500" x-text="translate('outputCertDesc')"></p>
                                <label class="flex items-center">
                                    <input class="w-4 h-4 text-purple-600 rounded focus:ring-purple-500"
                                           id="isOutputCert"
                                           type="checkbox" x-model="isOutputCert">
                                    <span class="ml-2 text-sm text-gray-700"
                                          x-text="translate('includeCertificateInOutput')">Include Certificate in Output</span>
                                </label>
                            </div>
                        </div>
                    </details>

                    <!-- Selected Certificates Mini Cards -->
                    <div class="bg-white rounded-lg shadow-sm p-6 mb-4" x-cloak
                         x-show="$store.certificateStore.selectedUserCert || $store.certificateStore.selectedCaCert">
                        <h4 class="text-lg font-semibold text-gray-700 mb-4"
                            x-text="translate('selectedCertificates')"></h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Selected User Certificate Mini Card -->
                            <div class="bg-indigo-50 border-l-4 border-indigo-400 rounded-lg p-4" x-cloak
                                 x-show="$store.certificateStore.selectedUserCert">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-start gap-3 flex-1">
                                        <div class="w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm bg-gradient-to-br from-indigo-400 to-indigo-600">
                                            <span x-text="$store.certificateStore?.selectedUserCert?.initials"></span>
                                        </div>
                                        <div class="min-w-0 flex-1">
                                            <h5 class="font-semibold text-gray-900 truncate"
                                                x-text="translate('userCertificate')"></h5>
                                            <p class="text-sm text-gray-600 truncate"
                                               x-text="$store.certificateStore?.selectedUserCert?.fullName"></p>
                                            <div class="mt-2 text-xs text-gray-500 space-y-1">
                                                <div>
                                                    <span x-text="translate('iinLabel') + ':'"></span>
                                                    <span class="font-mono ml-1"
                                                          x-text="$store.certificateStore?.selectedUserCert?.iin || 'N/A'"></span>
                                                </div>
                                                <div>
                                                    <span x-text="translate('validUntil') + ':'"></span>
                                                    <span class="ml-1"
                                                          x-text="$store.certificateStore?.selectedUserCert?.notAfterDate"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <button @click="$store.certificateStore.clearUserSelection()" class="text-gray-400 hover:text-gray-600 p-1"
                                            type="button">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round"
                                                  stroke-linejoin="round" stroke-width="2"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Selected CA Certificate Mini Card -->
                            <div class="bg-blue-50 border-l-4 border-blue-400 rounded-lg p-4" x-cloak
                                 x-show="$store.certificateStore.selectedCaCert">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-start gap-3 flex-1">
                                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm">
                                            CA
                                        </div>
                                        <div class="min-w-0 flex-1">
                                            <h5 class="font-semibold text-gray-900 truncate"
                                                x-text="translate('caCertificate')"></h5>
                                            <p class="text-sm text-gray-600 truncate"
                                               x-text="$store.certificateStore?.selectedCaCert?.alias || 'CA Certificate'"></p>
                                            <div class="mt-2 text-xs text-gray-500 space-y-1">
                                                <div>
                                                    <span>Serial:</span>
                                                    <span :title="$store.certificateStore?.selectedCaCert?.serialNumber"
                                                          class="font-mono ml-1 text-xs"
                                                          x-text="$store.certificateStore?.selectedCaCert?.serialNumber?.slice(-8) || 'N/A'"></span>
                                                </div>
                                                <div>
                                                    <span x-text="translate('validUntil') + ':'"></span>
                                                    <span class="ml-1"
                                                          x-text="$store.certificateStore?.selectedCaCert?.notAfterDate"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <button @click="$store.certificateStore.clearSelection()" class="text-gray-400 hover:text-gray-600 p-1"
                                            type="button">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round"
                                                  stroke-linejoin="round" stroke-width="2"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Signer Parameters Section -->
                    <details class="bg-white rounded-lg shadow-sm" open>
                        <summary
                                class="flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="w-6 h-6 bg-orange-100 rounded-full flex items-center justify-center">
                                    <svg class="w-3 h-3 text-orange-500" fill="none" stroke="currentColor"
                                         viewBox="0 0 24 24">
                                        <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                                              stroke-linecap="round" stroke-linejoin="round"
                                              stroke-width="2"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="text-base font-semibold text-gray-700"
                                        x-text="translate('signerParams')"></h4>
                                    <p class="text-sm text-gray-600" x-text="translate('signerParamsDesc')"></p>
                                </div>
                            </div>
                            <svg class="w-4 h-4 text-gray-400 transform transition-transform duration-200" fill="none"
                                 stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round"
                                      stroke-width="2"></path>
                            </svg>
                        </summary>
                        <div class="px-4 pb-4 space-y-4">
                            <!-- IIN -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1" for="iin"
                                       x-text="translate('iinLabel')"></label>
                                <input class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                       id="iin"
                                       maxlength="12" name="iin" pattern="[0-9]{12}"
                                       placeholder="IIN" title="IIN must be 12 digits"
                                       type="text" x-model="iin">
                            </div>

                            <!-- BIN -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1" for="bin"
                                       x-text="translate('binLabel')"></label>
                                <input class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                       id="bin"
                                       maxlength="12" name="bin" pattern="[0-9]{12}"
                                       placeholder="BIN" title="BIN must be 12 digits"
                                       type="text" x-model="bin">
                            </div>

                            <!-- Serial Number -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1" for="serialNumber"
                                       x-text="translate('serialLabel')"></label>
                                <input class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                       id="serialNumber"
                                       name="serialNumber" placeholder="Serial number"
                                       type="text" x-model="serialNumber">
                            </div>

                            <!-- Extended Key Usage -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1" for="extKeyUsageOids">
                                    <span x-html="translate('extKeyUsageDesc')"></span>
                                </label>
                                <textarea
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-vertical"
                                        id="extKeyUsageOids" rows="3"
                                        x-bind:placeholder="translate('extKeyUsagePlaceholder')"
                                        x-model="extKeyUsageOids"></textarea>
                            </div>

                            <!-- Certificate Chain -->
                            <div class="space-y-3">
                                <label class="block text-sm font-medium text-gray-700"
                                       x-text="translate('chainDesc')"></label>
                                <label class="flex items-center">
                                    <input class="w-4 h-4 text-orange-600 rounded focus:ring-orange-500" id="buildChain"
                                           type="checkbox" x-model="buildChain">
                                    <span class="ml-2 text-sm text-gray-700"
                                          x-text="translate('buildChainLabel')"></span>
                                </label>
                                <textarea
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-vertical"
                                        id="caCerts" placeholder="CA Certificates"
                                        rows="3"
                                        x-model="caCerts"></textarea>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2" for="caPemFile"
                                           x-text="translate('loadCaPemLabel')"></label>
                                    <input @change="loadCaPem($event)"
                                           accept=".pem"
                                           class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100 transition-colors"
                                           id="caPemFile" type="file">
                                </div>
                            </div>
                        </div>
                    </details>

                    <!-- Action Buttons -->
                    <div class="bg-white rounded-lg shadow-sm p-4">
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button :disabled="!dataToSign.trim() || allowedStorages.length === 0" @click="sign"
                                    class="flex-1 flex justify-center items-center px-4 py-2 bg-blue-400 text-white font-semibold rounded-lg hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-300 focus:ring-offset-2 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                                    id="signButton"
                                    type="button"
                                    x-text="loaders?.isSigning ? 'Signing...' : translate('signButton')">
                                <template x-if="loaders && !loaders?.isSigning">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                         x-cloak x-show="!loaders?.isSigning">
                                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round"
                                              stroke-linejoin="round"
                                              stroke-width="2"></path>
                                    </svg>
                                </template>
                                <template x-if="loaders && loaders?.isSigning">
                                    <svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor"
                                         viewBox="0 0 24 24"
                                         x-cloak x-show="loaders?.isSigning">
                                        <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                                              stroke-linecap="round" stroke-linejoin="round"
                                              stroke-width="2"></path>
                                    </svg>
                                </template>
                            </button>
                            <button @click="resetForm"
                                    class="px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-colors duration-200"
                                    type="button" x-text="translate('resetForm')">
                                Reset Form
                            </button>
                        </div>

                        <!-- Progress Bar -->
                        <div class="mt-4" x-cloak x-show="loaders?.isSigning">
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-400 h-2 rounded-full transition-all duration-300"
                                     style="width: 100%"></div>
                            </div>
                            <p class="text-sm text-gray-600 mt-2">Processing signature...</p>
                        </div>
                    </div>

                    <!-- Signature Output Section -->
                    <div class="bg-white rounded-lg shadow-sm p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="text-base font-semibold text-gray-700" x-text="translate('signatureOutput')">
                                Signature Output</h4>
                            <button @click="$dispatch('verify-signature', { signature })"
                                    class="px-3 py-1 text-sm bg-green-100 text-green-700 rounded hover:bg-green-200 transition-colors"
                                    type="button"
                                    x-show="signature">
                                Verify
                            </button>
                            <button @click="copyToClipboard(signature)"
                                    class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors"
                                    type="button"
                                    x-show="signature">
                                Copy to Clipboard
                            </button>
                        </div>
                        <textarea
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 resize-vertical"
                                id="signature" readonly
                                rows="8"
                                x-bind:placeholder="translate('signaturePlaceholder')" x-model="signature"></textarea>
                        <p class="text-xs text-gray-500 mt-2" x-text="translate('signaturePlaceholderHelp')">The signed
                            data will appear here after successful signing</p>
                    </div>
                </form>
            </div>
        </template>
        <template x-if="activeSubTab === 'cms'">
            <div class="w-full lg:w-3/4 flex items-center justify-center h-64">
                <p class="text-gray-500 italic">This feature allows signing CMS documents using server‑side
                    certificates. (Feature coming soon – contact administrator for access)</p>
            </div>
        </template>
    </div>
</div>
